<%= link_to 'My portfolios', portfolios_path %> | 
<%= link_to 'Sign out', destroy_user_session_path, method: :delete %> | 
<% if can? :crud, User %> 
    <%= link_to 'Delete Portfolio', @portfolio, method: "delete", data: { confirm: "Are you sure?" } %>
<% end %>

<h1>Hi, <%= current_user.username %>. | <%= @portfolio.name %> | <%= number_with_precision(@portfolio.return_percentage, precision: 2) %></h1> 

<span>Check out our <%= link_to 'stocks', industries_path(@portfolio) %></span>
<h3>Trading Balance: $<%= number_with_precision(@portfolio.current_balance, precision: 2) %></h3> 
<h3>Holdings: $<%= number_with_precision(@portfolio.holdings, precision: 2) %></h3>

<% if @portfolio.orders.empty? %>
    Your portfolio is empty.
<% else %>
    <%= content_tag :ul do %>
        <% @portfolio.orders.each do |order| %>
            <%= content_tag(:li, order.symbol) %> <%= link_to order.stock_name, stocks_path(portfolio_id: @portfolio.id, slug: order.symbol) %> | Total: $<%= number_with_precision((order.share_value), precision: 2) %>
            <p>Shares: <%= order.number_of_shares %></p>
            <p>
                <% if order.status == "success" %>
                    <%= link_to 'Request Sell', edit_portfolio_order_path(portfolio_id: @portfolio.id, id: order.id) %>
                <% elsif order.status == "pending" %>
                   Status: Pending <%= link_to 'Cancel Trade', portfolio_order_path(portfolio_id: @portfolio.id, id: order.id), :method => :delete %>
                <% elsif order.status == "rejected" %>
                    Status: Rejected <%= link_to 'Cancel Trade', portfolio_order_path(portfolio_id: @portfolio.id, id: order.id), :method => :delete %>
                <% else %>
                    Status: Sold
                <% end %>
            </p>

            <% if order.status == "pending" %>
                <p>Held at: $<%= number_with_precision(order.purchase_price, precision: 2) %></p>
            <% else %>
                <p>Bought at: $<%= number_with_precision(order.purchase_price, precision: 2) %></p>
            <% end %>

            <p>Current Price: $<%= number_with_precision(order.share_price, precision: 2) %></p> 

            <p><%= order.order_return_percentage %></p>
        <% end %>
    <% end %>
<% end %>


